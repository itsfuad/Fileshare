console.log("app.js loaded");const uploadBtn=document.getElementById("upload"),fileSelector=document.getElementById("file"),progressDisplay=document.getElementById("percent"),progressContainer=document.querySelector(".progress"),output=document.querySelector(".out"),container1=document.getElementById("container1"),container2=document.getElementById("container2"),title=document.getElementById("title"),fileDropZone=document.getElementById("drop_zone"),err=document.querySelector(".err");function showElem(elem){elem.style.display="flex",setTimeout(()=>{elem.classList.add("active")},100)}function hideElem(elem){elem.classList.remove("active"),setTimeout(()=>{elem.style.display="none"},100)}function generateQRcode(data){for(;document.getElementById("qrcode").firstChild;)document.getElementById("qrcode").removeChild(document.getElementById("qrcode").firstChild);let qrcode;return new QRCode(document.getElementById("qrcode"),{text:data,width:200,height:200,colorDark:"#000000",colorLight:"#ffffff",correctLevel:QRCode.CorrectLevel.H})}uploadBtn.addEventListener("click",async evt=>{if(evt.preventDefault(),fileSelector.files.length>0){if(fileSelector.files[0].size>15728640)return console.log("File must be within 15 mb"),popupMessage("File must be within 15 mb"),err.textContent="",err.classList.remove("shake"),err.textContent="*File must be within 15 mb*",err.classList.add("shake"),void setTimeout(()=>{err.classList.remove("shake")},1e3);if(!navigator.onLine)return console.log("No internet"),popupMessage("No internet"),err.textContent="",err.classList.remove("shake"),err.textContent="*No internet*",err.classList.add("shake"),void setTimeout(()=>{err.classList.remove("shake")},1e3);err.textContent="",err.classList.remove("shake"),title.textContent="Uploading...";const file=fileSelector.files[0],formData=new FormData;hideElem(container1),showElem(container2),showElem(progressContainer),formData.append("file",file);let xhr=new XMLHttpRequest;xhr.open("POST",`${location.origin}/api/files`,!0),xhr.upload.onprogress=function(e){if(e.lengthComputable){let progress=Math.floor(e.loaded/e.total*100);progressDisplay.textContent=`${progress}%`,document.querySelector(":root").style.setProperty("--percent",`${progress}%`)}},xhr.onload=function(e){if(200==this.status){const res=JSON.parse(e.target.response),file=res.file,size=res.metadata.filesize;generateQRcode(`${location.origin}/download/${file}/${size}`),document.getElementById("copyLink").dataset.link=`${location.origin}/download/${file}/${size}`,hideElem(progressContainer),showElem(output),title.textContent="File uploaded"}else console.log("Error"),popupMessage("Error Occured!"),resetForm()},xhr.send(formData)}});const link=document.getElementById("copyLink");function resetForm(){let filemeta=document.querySelector(".filemeta");filemeta.querySelector(".filename .name").textContent="",filemeta.querySelector(".filesize .size").textContent="",filemeta.style.display="none",filemeta.classList.add("hidden"),fileDropZone.style.outline="2px dashed #f1f1f17d",document.querySelector(".chooser").style.display="flex",setTimeout(()=>{document.querySelector(".chooser").classList.remove("hidden")},100),title.textContent="File Sharing Portal",showElem(container1),hideElem(container2),hideElem(output),showElem(progressContainer),container1.reset()}function copyText(text){if(null!=text){if(!navigator.clipboard)return void popupMessage("This browser does't support clipboard access");navigator.clipboard.writeText(text),popupMessage("Copied to clipboard")}}function popupMessage(text){document.querySelector(".popup-message").textContent=text,document.querySelector(".popup-message").classList.add("active"),setTimeout((function(){document.querySelector(".popup-message").classList.remove("active")}),1e3)}function readyToUpload(){let filename=fileSelector.files[0].name.length>10?fileSelector.files[0].name.substr(0,10)+"."+fileSelector.files[0].name.split(".").pop():fileSelector.files[0].name,filesize=fileSelector.files[0].size;filesize<1024?filesize+="b":filesize=filesize<1048576?(filesize/1024).toFixed(1)+"kb":(filesize/1048576).toFixed(1)+"mb",document.querySelector(".chooser").style.display="none",document.querySelector(".chooser").classList.add("hidden"),fileSelector.files.length>0?fileDropZone.style.outline="0px":fileDropZone.style.outline="2px dashed #f1f1f17d";let filemeta=document.querySelector(".filemeta");filemeta.querySelector(".filename .name").textContent=filename,filemeta.querySelector(".filesize .size").textContent=filesize,filemeta.style.display="block",setTimeout(()=>{filemeta.classList.remove("hidden")},40)}link.addEventListener("click",()=>{copyText(link.dataset.link)}),document.getElementById("reupload").addEventListener("click",()=>{resetForm()}),fileSelector.addEventListener("change",evt=>{readyToUpload()});let insideTarget=void 0,timeoutObj;fileDropZone.addEventListener("dragover",evt=>{insideTarget=!0}),fileDropZone.addEventListener("dragleave",evt=>{insideTarget=!1}),window.addEventListener("dragover",evt=>{evt.preventDefault(),evt.stopPropagation(),fileDropZone.classList.add("active"),fileDropZone.style.outline="2px dashed #f1f1f17d",insideTarget?(fileDropZone.style.outline="2px dashed #4598ff",timeoutObj&&clearTimeout(timeoutObj)):(fileDropZone.style.outline="2px dashed #f1f1f17d",timeoutObj&&clearTimeout(timeoutObj)),timeoutObj=setTimeout(()=>{fileDropZone.classList.remove("active"),fileSelector.files.length>0?fileDropZone.style.outline="0px":fileDropZone.style.outline="2px dashed #f1f1f17d"},100)}),window.addEventListener("drop",evt=>{evt.preventDefault(),fileDropZone.classList.remove("active"),insideTarget&&evt.dataTransfer.files.length>0&&(fileSelector.files=evt.dataTransfer.files,readyToUpload())}),window.addEventListener("paste",e=>{e.clipboardData&&e.clipboardData.files.length>0&&(fileSelector.files=e.clipboardData.files,readyToUpload())});