console.log("app.js loaded");const uploadBtn=document.getElementById("upload"),fileSelector=document.getElementById("file"),progressDisplay=document.getElementById("percent"),progressContainer=document.querySelector(".progress"),output=document.querySelector(".out"),container1=document.getElementById("container1"),container2=document.getElementById("container2"),title=document.getElementById("title"),err=document.querySelector(".err");function showElem(elem){elem.style.display="flex",setTimeout(()=>{elem.classList.add("active")},100)}function hideElem(elem){elem.classList.remove("active"),setTimeout(()=>{elem.style.display="none"},100)}function generateQRcode(data){for(console.log(`Making qr code with: ${data}`);document.getElementById("qrcode").firstChild;)document.getElementById("qrcode").removeChild(document.getElementById("qrcode").firstChild);let qrcode;return new QRCode(document.getElementById("qrcode"),{text:data,width:200,height:200,colorDark:"#000000",colorLight:"#ffffff",correctLevel:QRCode.CorrectLevel.H})}uploadBtn.addEventListener("click",async()=>{if(fileSelector.files.length>0){if(fileSelector.files[0].size>15728640)return console.log("File must be within 15 mb"),popupMessage("File must be within 15 mb"),err.textContent="",err.classList.remove("shake"),err.textContent="*File must be within 15 mb*",err.classList.add("shake"),void setTimeout(()=>{err.classList.remove("shake")},1e3);console.log("Ready to upload"),err.textContent="",err.classList.remove("shake"),console.log("uploading..."),title.textContent="Uploading...";const file=fileSelector.files[0],formData=new FormData;hideElem(container1),console.log("container1 hidden"),showElem(container2),console.log("container2 shown"),showElem(progressContainer),console.log("progress shown"),formData.append("file",file);let xhr=new XMLHttpRequest;xhr.open("POST",`${location.origin}/api/files`,!0),xhr.upload.onprogress=function(e){if(e.lengthComputable){let progress=Math.floor(e.loaded/e.total*100);progressDisplay.textContent=`${progress}%`,document.querySelector(":root").style.setProperty("--percent",`${progress}%`)}},xhr.onload=function(e){if(200==this.status){const res=JSON.parse(e.target.response),file=res.file,size=res.metadata.filesize;generateQRcode(`${location.origin}/download/${file}/${size}`),document.getElementById("copyLink").dataset.link=`${location.origin}/download/${file}/${size}`,hideElem(progressContainer),console.log("progress hidden"),showElem(output),console.log("output shown"),title.textContent="File uploaded"}else console.log("Error"),popupMessage("Error Occured!"),resetForm(),console.log("reset form")},xhr.send(formData)}});const link=document.getElementById("copyLink");function resetForm(){title.textContent="File Sharing Portal",showElem(container1),hideElem(container2),hideElem(output),showElem(progressContainer),container1.reset()}function copyText(text){if(null!=text){if(!navigator.clipboard)return void popupMessage("This browser does't support clipboard access");navigator.clipboard.writeText(text),console.log(text),popupMessage("Copied to clipboard")}}function popupMessage(text){document.querySelector(".popup-message").textContent=text,document.querySelector(".popup-message").classList.add("active"),setTimeout((function(){document.querySelector(".popup-message").classList.remove("active")}),1e3)}link.addEventListener("click",()=>{copyText(link.dataset.link)}),document.getElementById("reupload").addEventListener("click",()=>{resetForm()});